<head>
	<title>Mapping NC counties with D3</title>
	<link href="https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700%7CDroid+Sans:400,700%7CArvo:400,700" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="./main.min.css">
	<link rel="Shortcut Icon" href="http://wwwcache.wral.com/favicon.ico" />
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
	<style>
	   pre, code {
            padding: 5px;
            background-color: #e9e9e9;
        }
        .nc_county {
            stroke: #fff;
            stroke-width:0.7;
        }
        .nc_county:hover {
            stroke:#a6a8ab;
            stroke-width:1;
        }
        .selected {
            stroke:#a6a8ab;
            stroke-width:1;
        }
        #svg {
            width:100%;
            max-height: 100%;
        }
        svg {
            position: absolute;
            top: 0;
            left: 0;
        }
        .map_container {
            height: 0;
            padding-top: 38%;
            position: relative;
        }
        .maplegend {
            border:0;
            padding:0;
            text-align: center;
            font-size:12px;
            float:right;
            width:40px;
            height:15px;
            border-top:1px solid #a6a8ab;
            border-bottom:1px solid #a6a8ab;
        }
        .maplegend-a {
            border:0;
            padding:0;
            text-align: center;
            font-size:12px;
            float:right;
            width:40px;
            height:15px;
            border-top:1px solid #a6a8ab;
            border-left:1px solid #a6a8ab;
            border-bottom:1px solid #a6a8ab;
        }
        hr {
            margin-bottom:6px;
        }


        .us_state {
                fill:#f7f7f7;
                stroke:#a6a8ab;
                stroke-width:1;
        }
        .us_state:hover {
                stroke-width:3;
        }
        .selected {
                stroke-width:3;
                /*stroke:#6b6b6b;*/
        }
        select#state_select {
                height:40px;
                font-weight: bold;
                font-size: 16px;
        }
        #svg {
                width:100%;
                max-height: 100%;
        }
        svg {
                position: absolute;
                top: 0;
                left: 0;
        }
        .map_container {
                height: 0;
                padding-top: 65%;
                position: relative;
        }
	</style>
</head>
<body class="wral">
	<div class="g-wrap">
		<div class="container">
			<div class="1-default">
				<h2 style="margin-top:20px;">Mapping NC counties with D3</h2>
                                
                                <div style="clear:both;">
                                        <select style="margin-top:10px;" id="state_select"> 
                                                <option value="Alabama">Alabama</option> 
                                                <option value="Alaska">Alaska</option> 
                                                <option value="Arizona">Arizona</option> 
                                                <option value="Arkansas">Arkansas</option> 
                                                <option value="California">California</option> 
                                                <option value="Colorado">Colorado</option> 
                                                <option value="Connecticut">Connecticut</option> 
                                                <option value="Delaware">Delaware</option>
                                                <option value="Florida">Florida</option> 
                                                <option value="Georgia">Georgia</option> 
                                                <option value="Hawaii">Hawaii</option> 
                                                <option value="Idaho">Idaho</option> 
                                                <option value="Illinois">Illinois</option> 
                                                <option value="Indiana">Indiana</option> 
                                                <option value="Iowa">Iowa</option> 
                                                <option value="Kansas">Kansas</option> 
                                                <option value="Kentucky">Kentucky</option> 
                                                <option value="Louisiana">Louisiana</option> 
                                                <option value="Maine">Maine</option> 
                                                <option value="Maryland">Maryland</option> 
                                                <option value="Massachusetts">Massachusetts</option> 
                                                <option value="Michigan">Michigan</option> 
                                                <option value="Minnesota">Minnesota</option> 
                                                <option value="Mississippi">Mississippi</option> 
                                                <option value="Missouri">Missouri</option> 
                                                <option value="Montana">Montana</option> 
                                                <option value="Nebraska">Nebraska</option> 
                                                <option value="Nevada">Nevada</option> 
                                                <option value="New Hampshire">New Hampshire</option> 
                                                <option value="New Jersey">New Jersey</option> 
                                                <option value="New Mexico">New Mexico</option> 
                                                <option value="New York">New York</option> 
                                                <option value="North Carolina" selected="selected">North Carolina</option> 
                                                <option value="North Dakota">North Dakota</option>
                                                <option value="Ohio">Ohio</option>  
                                                <option value="Oklahoma">Oklahoma</option> 
                                                <option value="Oregon">Oregon</option> 
                                                <option value="Pennsylvania">Pennsylvania</option> 
                                                <option value="Rhode Island">Rhode Island</option> 
                                                <option value="South Carolina">South Carolina</option> 
                                                <option value="South Dakota">South Dakota</option> 
                                                <option value="Tennessee">Tennessee</option> 
                                                <option value="Texas">Texas</option> 
                                                <option value="Utah">Utah</option> 
                                                <option value="Vermont">Vermont</option> 
                                                <option value="Virginia">Virginia</option> 
                                                <option value="Washington">Washington</option> 
                                                <option value="West Virginia">West Virginia</option> 
                                                <option value="Wisconsin">Wisconsin</option> 
                                                <option value="Wyoming">Wyoming</option>
                                        </select>

                                        <!-- MAP HERE -->
                                        <div id="map" style="margin-bottom:0px;">
                                        </div>
                                        <!-- END MAP -->

                                        <div style="margin:0;">
                                                <div style="margin:0;padding-top:0px;display:block;">
                                                        <div style="float:right;padding-bottom:30px;">
                                                                <div style="text-align:center;text-transform:uppercase;font-size:12px;padding:0;">Legend</div>
                                                                <div>
                                                                        <div class="maplegend" style="background-color:#3182bd;"><br />75+</div>
                                                                        <div class="maplegend" style="background-color:#9ecae1;"><br />50-75</div>
                                                                        <div class="maplegend" style="background-color:#deebf7;"><br />25-50</div>
                                                                        <div class="maplegend-a" style="background-color:#eff3ff;"><br />0-25</div>
                                                                </div>
                                                        </div>
                                                </div>
                                                <div>
                                                        <h4 style="font-weight:300; margin-top:10px;line-height: 120%; color:#b7b7b7;">Variable: <span style="color:#333;"><span id="variable">6.45</span>%</span></h4>
                                                </div>
                                        </div>
                                </div>

				<p style="clear:both;">A basic, clean D3 map for applications and illustrations about the NC using county shapefiles.</p>

                                <p>Click a state and pull data from a related JSON file. This choropeth version colors counties according to predefined categories.</p>


				<h4 style="margin-top:20px;">Embed tag</h4>
				<pre lang="html">
&lt;style type="text/css">
.nc_county {
    stroke: #fff;
    stroke-width:0.7;
}
.nc_county:hover {
    stroke:#a6a8ab;
    stroke-width:1;
}
.selected {
    stroke:#a6a8ab;
    stroke-width:1;
}
#svg {
    width:100%;
    max-height: 100%;
}
svg {
    position: absolute;
    top: 0;
    left: 0;
}
.map_container {
    height: 0;
    padding-top: 38%;
    position: relative;
}
.maplegend {
        border:0;
        padding:0;
        text-align: center;
        font-size:12px;
        float:right;
        width:40px;
        height:15px;
        border-top:1px solid #a6a8ab;
        border-bottom:1px solid #a6a8ab;
}
.maplegend-a {
        border:0;
        padding:0;
        text-align: center;
        font-size:12px;
        float:right;
        width:40px;
        height:15px;
        border-top:1px solid #a6a8ab;
        border-left:1px solid #a6a8ab;
        border-bottom:1px solid #a6a8ab;
}
hr {
    margin-bottom:6px;
}
&lt;/style>
&lt;script src="http://d3js.org/topojson.v1.min.js">&lt;/script>
&lt;div style="clear:both;">
    &lt;hr />
    &lt;h4>Recipients by county&lt;/h4>
    &lt;p>Select a county below to find out how many childless able-bodied adults received food stamps, adjusted for each county's labor force, as of July 2015.&lt;/p>
        &lt;select style="margin-top:10px;" id="state_select">
                &lt;option value="ALAMANCE">ALAMANCE&lt;/option>
                &lt;option value="ALEXANDER">ALEXANDER&lt;/option>
                &lt;option value="ALLEGHANY">ALLEGHANY&lt;/option>
                &lt;option value="ANSON">ANSON&lt;/option>
                &lt;option value="ASHE">ASHE&lt;/option>
                &lt;option value="AVERY">AVERY&lt;/option>
                &lt;option value="BEAUFORT">BEAUFORT&lt;/option>
                &lt;option value="BERTIE">BERTIE&lt;/option>
                &lt;option value="BLADEN">BLADEN&lt;/option>
                &lt;option value="BRUNSWICK">BRUNSWICK&lt;/option>
                &lt;option value="BUNCOMBE">BUNCOMBE&lt;/option>
                &lt;option value="BURKE">BURKE&lt;/option>
                &lt;option value="CABARRUS">CABARRUS&lt;/option>
                &lt;option value="CALDWELL">CALDWELL&lt;/option>
                &lt;option value="CAMDEN">CAMDEN&lt;/option>
                &lt;option value="CARTERET">CARTERET&lt;/option>
                &lt;option value="CASWELL">CASWELL&lt;/option>
                &lt;option value="CATAWBA">CATAWBA&lt;/option>
                &lt;option value="CHATHAM">CHATHAM&lt;/option>
                &lt;option value="CHEROKEE">CHEROKEE&lt;/option>
                &lt;option value="CHOWAN">CHOWAN&lt;/option>
                &lt;option value="CLAY">CLAY&lt;/option>
                &lt;option value="CLEVELAND">CLEVELAND&lt;/option>
                &lt;option value="COLUMBUS">COLUMBUS&lt;/option>
                &lt;option value="CRAVEN">CRAVEN&lt;/option>
                &lt;option value="CUMBERLAND">CUMBERLAND&lt;/option>
                &lt;option value="CURRITUCK">CURRITUCK&lt;/option>
                &lt;option value="DARE">DARE&lt;/option>
                &lt;option value="DAVIDSON">DAVIDSON&lt;/option>
                &lt;option value="DAVIE">DAVIE&lt;/option>
                &lt;option value="DUPLIN">DUPLIN&lt;/option>
                &lt;option value="DURHAM">DURHAM&lt;/option>
                &lt;option value="EDGECOMBE">EDGECOMBE&lt;/option>
                &lt;option value="FORSYTH">FORSYTH&lt;/option>
                &lt;option value="FRANKLIN">FRANKLIN&lt;/option>
                &lt;option value="GASTON">GASTON&lt;/option>
                &lt;option value="GATES">GATES&lt;/option>
                &lt;option value="GRAHAM">GRAHAM&lt;/option>
                &lt;option value="GRANVILLE">GRANVILLE&lt;/option>
                &lt;option value="GREENE">GREENE&lt;/option>
                &lt;option value="GUILFORD">GUILFORD&lt;/option>
                &lt;option value="HALIFAX">HALIFAX&lt;/option>
                &lt;option value="HARNETT">HARNETT&lt;/option>
                &lt;option value="HAYWOOD">HAYWOOD&lt;/option>
                &lt;option value="HENDERSON">HENDERSON&lt;/option>
                &lt;option value="HERTFORD">HERTFORD&lt;/option>
                &lt;option value="HOKE">HOKE&lt;/option>
                &lt;option value="HYDE">HYDE&lt;/option>
                &lt;option value="IREDELL">IREDELL&lt;/option>
                &lt;option value="JACKSON">JACKSON&lt;/option>
                &lt;option value="JOHNSTON">JOHNSTON&lt;/option>
                &lt;option value="JONES">JONES&lt;/option>
                &lt;option value="LEE">LEE&lt;/option>
                &lt;option value="LENOIR">LENOIR&lt;/option>
                &lt;option value="LINCOLN">LINCOLN&lt;/option>
                &lt;option value="MACON">MACON&lt;/option>
                &lt;option value="MADISON">MADISON&lt;/option>
                &lt;option value="MARTIN">MARTIN&lt;/option>
                &lt;option value="MCDOWELL">MCDOWELL&lt;/option>
                &lt;option value="MECKLENBURG">MECKLENBURG&lt;/option>
                &lt;option value="MITCHELL">MITCHELL&lt;/option>
                &lt;option value="MONTGOMERY">MONTGOMERY&lt;/option>
                &lt;option value="MOORE">MOORE&lt;/option>
                &lt;option value="NASH">NASH&lt;/option>
                &lt;option value="NEW_HANOVER">NEW HANOVER&lt;/option>
                &lt;option value="NORTHAMPTON">NORTHAMPTON&lt;/option>
                &lt;option value="ONSLOW">ONSLOW&lt;/option>
                &lt;option value="ORANGE">ORANGE&lt;/option>
                &lt;option value="PAMLICO">PAMLICO&lt;/option>
                &lt;option value="PASQUOTANK">PASQUOTANK&lt;/option>
                &lt;option value="PENDER">PENDER&lt;/option>
                &lt;option value="PERQUIMANS">PERQUIMANS&lt;/option>
                &lt;option value="PERSON">PERSON&lt;/option>
                &lt;option value="PITT">PITT&lt;/option>
                &lt;option value="POLK">POLK&lt;/option>
                &lt;option value="RANDOLPH">RANDOLPH&lt;/option>
                &lt;option value="RICHMOND">RICHMOND&lt;/option>
                &lt;option value="ROBESON">ROBESON&lt;/option>
                &lt;option value="ROCKINGHAM">ROCKINGHAM&lt;/option>
                &lt;option value="ROWAN">ROWAN&lt;/option>
                &lt;option value="RUTHERFORD">RUTHERFORD&lt;/option>
                &lt;option value="SAMPSON">SAMPSON&lt;/option>
                &lt;option value="SCOTLAND">SCOTLAND&lt;/option>
                &lt;option value="STANLY">STANLY&lt;/option>
                &lt;option value="STOKES">STOKES&lt;/option>
                &lt;option value="SURRY">SURRY&lt;/option>
                &lt;option value="SWAIN">SWAIN&lt;/option>
                &lt;option value="TRANSYLVANIA">TRANSYLVANIA&lt;/option>
                &lt;option value="TYRRELL">TYRRELL&lt;/option>
                &lt;option value="UNION">UNION&lt;/option>
                &lt;option value="VANCE">VANCE&lt;/option>
                &lt;option value="WAKE" selected>WAKE&lt;/option>
                &lt;option value="WARREN">WARREN&lt;/option>
                &lt;option value="WASHINGTON">WASHINGTON&lt;/option>
                &lt;option value="WATAUGA">WATAUGA&lt;/option>
                &lt;option value="WAYNE">WAYNE&lt;/option>
                &lt;option value="WILKES">WILKES&lt;/option>
                &lt;option value="WILSON">WILSON&lt;/option>
                &lt;option value="YADKIN">YADKIN&lt;/option>
                &lt;option value="YANCEY">YANCEY&lt;/option>
        &lt;/select>
    &lt;div class="map-loading" style="height:225px;">
        &lt;h3 style="text-align:center;margin-top:40px;margin-bottom:10px;text-transform:uppercase;">Loading map&lt;/h3>
        &lt;img src="http://wwwcache.wral.com/presentation/v3/images/widgets/wait_popup/spinner.gif" style="width:31px;margin:auto;display:block;" />
    &lt;/div>
    &lt;div id="map" style="margin-bottom:0px; display:none;">
    &lt;/div>
    &lt;div style="margin:0;">
        &lt;div style="margin:0;padding-top:0px;display:block;">
            &lt;div style="float:right;padding-bottom:30px;">
                &lt;div style="text-align:center;text-transform:uppercase;font-size:12px;padding:0;">Percent of labor force&lt;/div>
                &lt;div>
                    &lt;div class="maplegend" style="background-color:#2171b5;">&lt;br />&nbsp;3.3+&lt;/div>
                    &lt;div class="maplegend" style="background-color:#6baed6;">&lt;br />&nbsp;to 3.3&lt;/div>
                    &lt;div class="maplegend" style="background-color:#bdd7e7;">&lt;br />&nbsp;to 2.3&lt;/div>
                    &lt;div class="maplegend-a" style="background-color:#eff3ff;">&lt;br />0-1.7&lt;/div>
                &lt;/div>
            &lt;/div>
        &lt;/div>
        &lt;div>
            &lt;h4 id="countyTitle">WAKE&lt;/h4>
            &lt;h4 style="font-weight:300; margin-top:10px;line-height: 120%; color:#b7b7b7;">Childless able-bodied adults receiving food stamps as a percentage of labor force:&lt;br />&lt;span style="color:#333; font-size:120%; line-height: 140%;">&lt;span id="variable">0.77&lt;/span>%&lt;/span>&lt;/h4>
        &lt;/div>
        &lt;p>&lt;b>Childless able-bodied adults receiving food stamps:&lt;/b> &lt;span id="abawd">4,186&lt;/span>&lt;br />
        &lt;b>Labor force:&lt;/b> &lt;span id="labor_force">540,657&lt;/span>&lt;br />
        &lt;b>Unemployed:&lt;/b> &lt;span id="unemployed">27,731&lt;/span>&lt;br />
        &lt;b>Unemployment rate:&lt;/b> &lt;span id="ue_rate">5.1&lt;/span>%&lt;/p>
        &lt;div style="text-align: right; font-style: italic; font-size: 11px; color: rgb(171, 171, 171); font-family:'Droid Sans',Helvetica,sans-serif; margin:10px 0 0 0; padding:0px; clear:both;">
            Source: NC DHHS, NC Commerce
        &lt;/div>
        &lt;div style="text-align: right; font-style: italic; font-size: 11px; color: rgb(171, 171, 171); font-family:'Droid Sans',Helvetica,sans-serif; margin:0; padding:0px; clear:both;">
            Graphic by &lt;a href="http://www.wral.com/rs/bio/13311372/">Tyler Dukes&lt;/a>
        &lt;/div>
    &lt;/div>
    &lt;hr />
&lt;/div>
                                </pre>
				<br />

				<h4 style="margin-top:20px;">RequireJS Module</h4>
				<pre>
require(
  ['jquery','lodash', 'http://d3js.org/d3.v3.min.js','http://d3js.org/topojson.v1.min.js'],

  function($, _) {

    var abawd_data;
    
    //pulling data from: 14791220
    $.get('news/state/nccapitol/data_set/14943198/?dsi_id=abawd-rate&version=jsonObj',function(data){
      abawd_data = data;

    //initial height and width recalculated
    var width = 600,
    height = 220;

    var projection = d3.geo.mercator()
    .scale(3850)
    .center([102.8,33.5])
    .rotate([-180,0]);

    var path = d3.geo.path().projection(projection);

    //resizing from here: http://stackoverflow.com/questions/20885164/how-to-create-a-responsive-map-using-d3
    var svg = d3.select("#map")
    .append("div")
    .attr("id","svg")
    .append("div")
    .attr("class","map_container")
    .append("svg")
    .attr("viewBox","0 0 " + width + " " + height)
    .attr("preserveAspectRatio","xMinYMin");

    d3.json("/news/state/data_set/14304699/?dsi_id=nc_counties&version=jsonObj", function(error, nc) {
      svg.selectAll(".nc_county")
      .data(topojson.feature(nc, nc.objects.nc_counties).features)
      .enter().append("path")
      .attr("class", function(d) {
        if(d.properties.NAME == "Wake"){return "nc_county " + d.properties.NAME + " selected"}
          else{return "nc_county " + d.properties.NAME}
        })
      .attr("id", function(d) {return d.properties.NAME.toUpperCase().split(' ').join('_')})
      .attr("d", path)
      .on("click", function(d) {
        d3.selectAll(".selected").classed("selected", false);
        d3.select(this).classed("selected", true);
        svg.selectAll("path").sort(function (a, b) { // select the parent and sort the path's
          if (a != d) return -1;               // a is not the clicked element, send "a" to the back
          else return 1;                             // a is the clicked element, bring "a" to the front
        });
        county = $(this).attr('id');
        $('#state_select').val(county);
        var abawd;
        var labor_force;
        var unemployed;
        var ue_rate;
        $('#variable').html(function(){
          for(i=0; i<abawd_data.length; i++){
            if(county == abawd_data[i]['county']){
              abawd = abawd_data[i]['abawd'];
              console.log(abawd);
              labor_force = abawd_data[i]['labor_force'];
              unemployed = abawd_data[i]['unemployed'];
              ue_rate = abawd_data[i]['ue_rate'];
              return abawd_data[i]['abawd_rate'];
            }
          }
        });
        $('#abawd').html(abawd);
        $('#labor_force').html(labor_force);
        $('#unemployed').html(unemployed);
        $('#ue_rate').html(ue_rate);
        $('#countyTitle').html(county.replace(/_/g, ' '));
      })
      parseData();
      $('.map-loading').css('display','none');
      $('#map').css('display','block');
    });

    function parseData(){
      for (j=0; j < abawd_data.length; j++){
            variable = parseFloat(abawd_data[j]['abawd_rate']);
            id_name = '#'+ abawd_data[j]['county'];
            if (id_name == "#DC"){
              //ignore because there's no visible shapefile
            }
            else {
              switch (true){
                case (variable < 1.72178592 ):
                  $(id_name).css('fill','#eff3ff');
                  break;
                case (variable >= 1.72178592 && variable < 2.363903231 ):
                  $(id_name).css('fill','#deebf7');
                  break;
                case (variable >= 2.363903231 && variable < 3.28539106 ):
                  $(id_name).css('fill','#9ecae1');
                  break;
                case (variable >= 3.28539106 ):
                  $(id_name).css('fill','#3182bd');
                  break;
                default:
                  console.log("ERROR: no color category")
                  break;
              }
            }
          }
      }

      //workaround for making sure path appears on top
      jQuery.fn.d3Click = function () {
        this.each(function (i, e) {
          var evt = document.createEvent("MouseEvents");
          evt.initMouseEvent("click", true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
          e.dispatchEvent(evt);
        });
      };

      $('#state_select').change(function(e){
        e.preventDefault();
        county_display = $(this).val()
        var i = 0;
        while(abawd_data[i]['county'] != county_display){
          i++;
        }
        $('path').removeClass('selected');
        $('#'+ county_display).addClass('selected');
        document.getElementById("variable").innerHTML = abawd_data[i]['abawd_rate'];
        //Invoke d3 command for making sure path is properly shaded
        $('#'+county_display).d3Click();
      });

    });//END OF GET
  }
);
				</pre>
			</div>
		</div>
	</div>

    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script src="http://d3js.org/topojson.v1.min.js"></script>
	<script>
        var abawd_data;
    
        //pulling data from: 14791220
        $.get('news/state/nccapitol/data_set/14943198/?dsi_id=abawd-rate&version=jsonObj',function(data){
            abawd_data = data;

            //initial height and width recalculated
            var width = 600,
            height = 220;

            var projection = d3.geo.mercator()
            .scale(3850)
            .center([102.8,33.5])
            .rotate([-180,0]);

            var path = d3.geo.path().projection(projection);

            //resizing from here: http://stackoverflow.com/questions/20885164/how-to-create-a-responsive-map-using-d3
            var svg = d3.select("#map")
            .append("div")
            .attr("id","svg")
            .append("div")
            .attr("class","map_container")
            .append("svg")
            .attr("viewBox","0 0 " + width + " " + height)
            .attr("preserveAspectRatio","xMinYMin");

            d3.json("/news/state/data_set/14304699/?dsi_id=nc_counties&version=jsonObj", function(error, nc) {
                svg.selectAll(".nc_county")
                .data(topojson.feature(nc, nc.objects.nc_counties).features)
                .enter().append("path")
                .attr("class", function(d) {
                    if(d.properties.NAME == "Wake"){return "nc_county " + d.properties.NAME + " selected"}
                    else{return "nc_county " + d.properties.NAME}
                })
                .attr("id", function(d) {return d.properties.NAME.toUpperCase().split(' ').join('_')})
                .attr("d", path)
                .on("click", function(d) {
                    d3.selectAll(".selected").classed("selected", false);
                    d3.select(this).classed("selected", true);
                    svg.selectAll("path").sort(function (a, b) { // select the parent and sort the path's
                        if (a != d) return -1;               // a is not the clicked element, send "a" to the back
                        else return 1;                             // a is the clicked element, bring "a" to the front
                    });
                    county = $(this).attr('id');
                    $('#state_select').val(county);
                    var abawd;
                    var labor_force;
                    var unemployed;
                    var ue_rate;
                    $('#variable').html(function(){
                        for(i=0; i<abawd_data.length; i++){
                            if(county == abawd_data[i]['county']){
                                abawd = abawd_data[i]['abawd'];
                                console.log(abawd);
                                labor_force = abawd_data[i]['labor_force'];
                                unemployed = abawd_data[i]['unemployed'];
                                ue_rate = abawd_data[i]['ue_rate'];
                                return abawd_data[i]['abawd_rate'];
                                }
                        }
                    });
                    $('#abawd').html(abawd);
                    $('#labor_force').html(labor_force);
                    $('#unemployed').html(unemployed);
                    $('#ue_rate').html(ue_rate);
                    $('#countyTitle').html(county.replace(/_/g, ' '));
                })
                parseData();
                $('.map-loading').css('display','none');
                $('#map').css('display','block');
            });

            function parseData(){
                for (j=0; j < abawd_data.length; j++){
                    variable = parseFloat(abawd_data[j]['abawd_rate']);
                    id_name = '#'+ abawd_data[j]['county'];
                    switch (true){
                        case (variable < 1.72178592 ):
                            $(id_name).css('fill','#eff3ff');
                            break;
                        case (variable >= 1.72178592 && variable < 2.363903231 ):
                            $(id_name).css('fill','#deebf7');
                            break;
                        case (variable >= 2.363903231 && variable < 3.28539106 ):
                            $(id_name).css('fill','#9ecae1');
                            break;
                        case (variable >= 3.28539106 ):
                            $(id_name).css('fill','#3182bd');
                            break;
                        default:
                            console.log("ERROR: no color category")
                            break;
                    }
                }
            }

            //workaround for making sure path appears on top
            jQuery.fn.d3Click = function () {
                this.each(function (i, e) {
                    var evt = document.createEvent("MouseEvents");
                    evt.initMouseEvent("click", true, true, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);
                    e.dispatchEvent(evt);
                });
            };

            $('#state_select').change(function(e){
                e.preventDefault();
                county_display = $(this).val()
                var i = 0;
                while(abawd_data[i]['county'] != county_display){
                    i++;
                }
                $('path').removeClass('selected');
                $('#'+ county_display).addClass('selected');
                document.getElementById("variable").innerHTML = abawd_data[i]['abawd_rate'];
                //Invoke d3 command for making sure path is properly shaded
                $('#'+county_display).d3Click();
            });

        });//END OF GET
        </script>
</body>